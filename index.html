<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
    
        <title>Lightning Out POC</title>
    
        <script type="module" src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"></script>
        <script nomodule src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"></script>
        <script src="https://eon--develop1.lightning.force.com/lightning/lightning.out.js"></script>
    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css"/>
        <style>
            :root {
              --ion-safe-area-top: 20px;
              --ion-safe-area-bottom: 22px;
            }
          </style>
          <script type="module">
            import { actionSheetController } from 'https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/index.esm.js';
            window.actionSheetController = actionSheetController;
          </script>
    </head>
    <body>
    
    
    <script>
        console.log(window.location.search);
        var queryString = window.location.search;
        var urlParams = new URLSearchParams(queryString);
        var recId = urlParams.get('recordId');
    
        function callLightningOut(componentName, title) {
           let divId = title; 
           let content = document.querySelector('.c-id'); 
            console.log("v3")
           let card = document.createElement('ion-card');
           card.innerHTML = `
           <ion-progress-bar type="indeterminate" id="${title}loader"></ion-progress-bar> <ion-card-header>
            <ion-card-title>${title}</ion-card-title>

          </ion-card-header>
          <div id="${title}"></div>`; 
           card.id = title; 
          content.appendChild(card); 
            $Lightning.use(
                "c:lightningOut",
                () => {
                    let cmpname = `c:${componentName}`;
    
                    $Lightning.createComponent(
                        cmpname,
                        {recordId: recId},
                        divId,
                        () => {
                            console.log("LWC component was created");
                            
                        document.querySelector(`${title}loader`).remove(); 
                        }
                    );
                },
                "https://eon--develop1.lightning.force.com",
                    urlParams.get('token')
            );
    
        }
        async function presentActionSheet() {
            const actionSheet = document.createElement('ion-action-sheet');
          
            actionSheet.header = 'Albums';
            actionSheet.cssClass = 'my-custom-class';
            actionSheet.buttons = [{
              text: 'Abweichenden Empfänger hinzufügen',
              role: 'destructive',
              icon: 'trash',
              handler: () => {
                callLightningOut("DA_SC_AddRecipientWrapper", "Abweichenden Empfänger hinzufügen"); 
              }
            }, {
              text: 'Abweichenden Empfänger ändern',
              icon: 'share',
              handler: () => {
                callLightningOut("DA_SC_ChangeRecipientWrapper",'Abweichenden Empfänger ändern'); 
              }
            }, {
              text: 'Abschlag anpassen',
              icon: 'caret-forward-circle',
              handler: () => {
                callLightningOut("daApAmendPaymentWrapper",'Abschlag anpassen'); 
              }
            }, {
              text: 'Zahlungsart anpassen',
              icon: 'heart',
              handler: () => {
                callLightningOut("DA_NextStep_BankDetailsWrapper",'Zahlungsart anpassen'); 
              }
            }, 
            {
                text: 'Vertrag bündeln',
                icon: 'heart',
                handler: () => {
                    callLightningOut("DA_BundlingWrapper",'Vertrag bündeln'); 
                }
              }, 
              {
                text: 'Adresse bearbeiten',
                icon: 'heart',
                handler: () => {
                    callLightningOut("daManageAddressInitiator", 'Adresse bearbeiten'); 
                }
              }, 
              {
                text: 'Rechnung korrigieren',
                icon: 'heart',
                handler: () => {
                    callLightningOut("DA_InvoiceCorrectionWrapper",'Rechnung korrigieren'); 
                }
              }, 
              {
                text: 'Payback-Nummer bearbeiten',
                icon: 'heart',
                handler: () => {
                    callLightningOut("DA_EditPaybackNumber",'Payback-Nummer bearbeiten'); 
                }
              },  {
                text: 'Persönliche Daten bearbeiten',
                icon: 'heart',
                handler: () => {
                    callLightningOut("daEditContactWrapper",'Persönliche Daten bearbeiten'); 
                }
              },
              {
                text: 'Einwilligungen verwalten',
                icon: 'heart',
                handler: () => {
                    callLightningOut("DA_OptIn_EinholungWrapper",'Einwilligungen verwalten'); 
                }
              }];
            document.body.appendChild(actionSheet);
            return actionSheet.present();
          }
    </script>
    
    <!-- We declare an Ionic app using the <ion-app/> element -->
    <ion-app>      
        <ion-toolbar>
        <ion-title>Lightning Out Prototype</ion-title>
    
    
      </ion-toolbar>
    </ion-header>
        <!-- Cool thing, the Ionic CSS utilities could be used too -->
        <ion-content text-center fullscreen class="ion-padding c-id">
            <!-- We add an ion-button with an onclick event -->
            <ion-card>
    
                <ion-card-header>
                  <ion-card-subtitle>Vertragskonto-Nr. 123456</ion-card-subtitle>
                  <ion-card-title>Max Mustermann</ion-card-title>
                  
                </ion-card-header>
              
                <ion-card-content>
                    <ion-label>Aktuelle Rechnung vom 12.10.2020: 130,99€</ion-label>
                </br> <ion-chip color="tertiary">
                   
                        <ion-label color="dark">Neuer Tarif verfügbar!</ion-label>
                      </ion-chip>
    
                </ion-card-content>
              </ion-card>
    
              <ion-button onclick="presentActionSheet()" expand="full">Vertrag bearbeiten</ion-button>
        </ion-content>
    </ion-app>

</body>
</html>